/**
 * Swipe Panel Class (beta)
 *
 * © 2012-2013 Andrea Blasio
 *
 * Released under MIT License & GNU Free Documentation License
 *
 * Demo page: http://www.humanafragilitas.com/demos/swipe_panel/swipePanel.html
 *
 * Further insight: http://www.humanafragilitas.com/archives/508
 *
 */

if(typeof HF==="undefined"){var HF={}}HF.SwipePanel=function SwipePanel(f){var k=window,x=k.document,y=x.body,m=y.style,q,p,A,v,r,o,n,j,a,c,z,h,g,u,l={offsetParent:"",panelID:"",panelLabelIDString:"",panelLabelOpenTag:"",panelLabelClosedTag:"",swipePanelWrapperColours:["#454545","#242424"],swipePanelLabelColours:["#F8B708","#F9CC52","#fade92"],swipePanelZIndex:9998,swipeSensivity:7,onReady:null,onBeforeOpen:null,onOpen:null,onBeforeClose:null,onClose:null};function t(){var b,d=[],w=[],s=[],i;d.push("display: inline-block;");d.push("padding: 0 18px 0 18px;");d.push("background-image: "+c.repeatingLinearGradient);d.push("(90deg, ");d.push(l.swipePanelLabelColours[0]+", ");d.push(l.swipePanelLabelColours[0]+" 1px, ");d.push(l.swipePanelLabelColours[1]+" 1px, ");d.push(l.swipePanelLabelColours[1]+" 2px);");d.push(c.transition+":"+c.transform+" 0.15s ease-out;");d.push("height: 48px;");d.push("line-height: 48px;");d.push("cursor: move;");d.push(c.userSelect+": none;");d.push("z-index: "+(l.swipePanelZIndex+1)+";");w.push("border-top-left-radius: 0;");w.push("border-top-right-radius: 0;");w.push("border-bottom-left-radius: 4px;");w.push("border-bottom-right-radius: 4px;");w.push("text-shadow: 0 -1px ");w.push(l.swipePanelLabelColours[2]+";");w.push("box-shadow: 0 2px 4px rgba(0,0,0,.5),");w.push("0 1px 1px rgba(0,0,0,.2),");w.push("0 1px 1px #333333 inset;");s.push("border-top-left-radius: 4px;");s.push("border-top-right-radius: 4px;");s.push("border-bottom-left-radius: 0;");s.push("border-bottom-right-radius: 0;");s.push("text-shadow: 0 1px ");s.push(l.swipePanelLabelColours[2]+";");s.push("box-shadow: 0 -2px 5px rgba(0,0,0,.7),");s.push("0 -1px 1px rgba(0,0,0,.4),");s.push("0 -1px 1px #333333 inset;");b=x.createElement("span");b.setAttribute("id",l.panelLabelIDString);b.style.cssText=d.join("");i=function(B){switch(B){case"closed":b.style.cssText=d.join("")+s.join("");b.innerHTML=l.panelLabelClosedTag;b.style[c.domTransform]=u(0,(b.offsetHeight*-1),0);break;case"open":b.style.cssText=d.join("")+w.join("");b.innerHTML=l.panelLabelOpenTag;b.style[c.domTransform]=u(0,0,0);break}};b.setStatus=i;return b}function e(C){var b,s,G,E,F=[],i=[],B,d,H,D,w;F.push("position: absolute;");F.push("top: 0;");F.push("background:");F.push(c.radialGradient+"(50% 50%, ellipse cover, rgba(0,0,0,.3) 0%, rgba(0,0,0,1) 130%),");F.push(c.repeatingLinearGradient);F.push("(0deg, "+l.swipePanelWrapperColours[0]+" 0px,");F.push(l.swipePanelWrapperColours[1]+" 2px,");F.push(l.swipePanelWrapperColours[1]+" 4px);");F.push("text-align: center;");F.push("box-shadow: 0 0 8px rgba(0,0,0,.7) inset,");F.push("0 0 3px rgba(0,0,0,.7) inset,");F.push("0 -1px 1px rgba(255,255,255,.3);");F.push("cursor: move;");i.push("position: relative;");i.push("width: 100%;");i.push("height: 1px;");i.push("z-index: "+l.swipePanelZIndex+";");b=C;b.style.cssText=F.join("");b.isOpen=false;b.hasChangedStatus=false;b.isDragged=false;E=x.createElement("div");E.style.cssText=i.join("");G=new t();G.setStatus("closed");E.appendChild(G);if((s=b.childNodes).length>0){b.insertBefore(E,s[0])}else{b.appendChild(E)}H=function(K,I,J){if(I){b.style[c.domTransition]=c.transform+" 0.3s ease-in-out"}else{b.style[c.domTransition]="none"}switch(K){case"close":(b.isOpen)?b.hasChangedStatus=true:b.hasChangedStatus=false;b.isOpen=false;b.isDragged=false;b.style[c.domTransform]=u(0,J,0);break;case"open":(!b.isOpen)?b.hasChangedStatus=true:b.hasChangedStatus=false;b.isOpen=true;b.isDragged=false;b.style[c.domTransform]=u(0,0,0);break;case"drag":b.style[c.domTransform]=u(0,J,0);b.isDragged=true;break}};B=function(I){b.style.width=I.width+"px";b.style.height=I.height+"px";if(b.isOpen===false){b.move("close",false,I.height)}};d=function d(){if(b.isOpen){G.setStatus("open")}else{G.setStatus("closed")}};w=function(){return G.offsetHeight};D=function(){return G};b.getLabelInstance=D;b.getLabelHeight=w;b.updateSize=B;b.updatePanelLabel=d;b.move=H;return b}h=(function(){var i,d,b;return{buildInterface:function(){try{i=x.querySelector(l.panelID);b=i.offsetParent}catch(s){throw new Error("Swipe Panel: illegal panelID and/or offset element.")}if(!i||!b){throw new Error("Swipe Panel: panelID and/or offset element do not exist.")}d=new e(i);d.updatePanelLabel();b.style.overflow="hidden";if(typeof l.onReady==="function"){l.onReady.call(d)}},getOffsetParentSize:function(){var s,B,w;s=b.offsetWidth;B=b.offsetHeight;w=(B<s);return{width:s,height:B,isLandscape:w}},getOffsetParentInstance:function(){return b},getWrapperInstance:function(){return d},getLabelInstance:function(){return d.getLabelInstance()}}}());g=(function(){var d,i,b,s={x1:0,y1:0,x2:0,y2:0,d:0};return{attachEventListeners:function(){i=h.getWrapperInstance();b=h.getLabelInstance();d=h.getOffsetParentInstance();b.addEventListener(v,g.touchStartHandler,false);b.addEventListener(o,g.touchEndHandler,false);k.addEventListener(j,g.resizeHandler,false);k.addEventListener(n,g.resizeHandler,false);g.resizeHandler(null)},transitionEndHandler:function(w){i.removeEventListener(a,g.transitionEndHandler);i.updatePanelLabel();if(!i.isOpen&&i.hasChangedStatus&&(typeof l.onOpen==="function")){l.onClose.call(i)}if(i.isOpen&&i.hasChangedStatus&&(typeof l.onClose==="function")){l.onOpen.call(i)}s.d=0},touchStartHandler:function(B){var w;B.preventDefault();w=B.target;if(!i.isDragged){B.preventDefault();s.y1=p?B.touches[0].screenY:A?B.clientY:B.clientY;d.addEventListener(r,g.touchMoveHandler,false)}},touchMoveHandler:function(w){var C,B;w.preventDefault();B=h.getOffsetParentSize();s.y2=p?w.touches[0].screenY:A?w.clientY:w.clientY;s.d=Math.abs((s.y1-s.y2));if(!i.isOpen){C=B.height-s.d}else{C=s.d}i.move("drag",false,C)},touchEndHandler:function(B){var w,C;B.preventDefault();w=B.target;C=h.getOffsetParentSize();d.removeEventListener(r,g.touchMoveHandler);i.addEventListener(a,g.transitionEndHandler,false);if(s.d>(C.height/l.swipeSensivity)){if(i.isOpen){i.move("close",true,C.height);l.onBeforeClose.call(swipePanel)}else{i.move("open",true,0);l.onBeforeOpen.call(swipePanel)}}else{(i.isOpen)?i.move("open",true,0):i.move("close",true,C.height)}},resizeHandler:function(w){var B;B=h.getOffsetParentSize();i.updateSize(B);if(i.isOpen===false){i.move("close",false,B.height)}},dispatchCustomEvent:function(C,D,B){var E,w;if(B===true){w=h.getOffsetParentSize();s.d=(w.height/l.swipeSensivity)+1}E=document.createEvent("HTMLEvents");E.initEvent(C,true,true);E.eventName=C;D.dispatchEvent(E)}}}());u=function(b,i,d){if(c.translate3d){u=function(s,B,w){return"translate3d("+s+"px, "+B+"px, "+w+")"}}else{u=function(s,B,w){return"translate("+s+"px, "+B+"px)"}}u()};p=("ontouchstart" in k)&&("ontouchmove" in k)&&("ontouchend" in k)&&("ontouchcancel" in k);A=("onmspointerdown" in k)&&("onmspointermove" in k)&&("onmspointerup" in k)&&("onmspointerover" in k)&&("onmspointerout" in k);v=p?"touchstart":A?"MSPointerDown":"mousedown";r=p?"touchmove":A?"MSPointerMove":"mousemove";o=p?"touchend":A?"MSPointerUp":"mouseup";n="orientationchange";j="resize";a=("onwebkittransitionend" in k)?"webkitTransitionEnd":"transitionend";c=("MozTransition" in m&&"MozTransform" in m)?{domTransition:"MozTransition",transition:"-moz-transition",transform:"-moz-transform",domTransform:"MozTransform",radialGradient:"-moz-radial-gradient",repeatingLinearGradient:"-moz-repeating-linear-gradient",translate3d:"translate3d",userSelect:"-moz-user-select"}:("WebkitTransition" in m&&"WebkitTransform" in m)?{domTransition:"WebkitTransition",transition:"-webkit-transition",transform:"-webkit-transform",domTransform:"WebkitTransform",radialGradient:"-webkit-radial-gradient",repeatingLinearGradient:"-webkit-repeating-linear-gradient",translate3d:"translate3d",userSelect:"-webkit-user-select"}:("msTransition" in m&&"msTransform" in m)?{domTransition:"msTransition",transition:"-ms-transition",transform:"-ms-transform",domTransform:"msTransform",radialGradient:"-ms-radial-gradient",repeatingLinearGradient:"-ms-repeating-linear-gradient",translate:"translate",userSelect:"-ms-user-select"}:{domTransition:"transition",transition:"transition",transform:"transform",domTransform:"transform",radialGradient:"radial-gradient",repeatingLinearGradient:"repeating-linear-gradient",translate:"translate",userSelect:"user-select"};if(typeof f!=="object"){throw new Error("SwipePanel: initialize method argument is not an object.")}for(q in l){if(f.hasOwnProperty(q)&&f[q]){l[q]=f[q]}}h.buildInterface();g.attachEventListeners();HF.SwipePanel.prototype.toggle=function(){g.dispatchCustomEvent(o,h.getLabelInstance(),true)};HF.SwipePanel.prototype.open=function(){if(h.getWrapperInstance().isOpen===false){this.toggle()}};HF.SwipePanel.prototype.close=function(){if(h.getWrapperInstance().isOpen===true){this.toggle()}};this.isOpen=h.getWrapperInstance().isOpen};